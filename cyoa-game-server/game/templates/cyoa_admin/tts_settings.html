{% extends "cyoa_admin/base.html" %}

{% block title %}TTS Settings{% endblock %}
{% block page_title %}Text-to-Speech Settings{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold text-gray-900 mb-6">
        Text-to-Speech Settings
    </h1>

    <form method="post" autocomplete="off" class="bg-white shadow-md rounded-lg p-6 space-y-6">
        {% csrf_token %}
        
        <!-- Enable/Disable TTS -->
        <div class="border-b border-gray-200 pb-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">General Settings</h2>
            
            <div class="flex items-center justify-between mb-4">
                <div>
                    <label for="enabled" class="block text-sm font-medium text-gray-700">Enable TTS</label>
                    <p class="text-sm text-gray-500 mt-1">Allow users to generate speech from story text</p>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" name="enabled" id="enabled" class="sr-only peer" {% if settings.enabled %}checked{% endif %}>
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                </label>
            </div>
            
            <div class="mb-4">
                <label for="max_text_length" class="block text-sm font-medium text-gray-700 mb-2">Max Text Length</label>
                <input type="number" name="max_text_length" id="max_text_length" required autocomplete="off"
                       value="{{ settings.max_text_length }}" min="1" max="4096"
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                <p class="text-sm text-gray-500 mt-1">Maximum number of characters for TTS (OpenAI limit: 4096)</p>
            </div>
        </div>
        
        <!-- OpenAI Settings -->
        <div class="border-b border-gray-200 pb-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">OpenAI TTS Settings</h2>
            
            <div class="mb-4">
                <label for="openai_model" class="block text-sm font-medium text-gray-700 mb-2">Model</label>
                <select name="openai_model" id="openai_model" autocomplete="off"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    <option value="tts-1" {% if settings.openai_model == 'tts-1' %}selected{% endif %}>
                        TTS-1 (Fast, Standard Quality)
                    </option>
                    <option value="tts-1-hd" {% if settings.openai_model == 'tts-1-hd' %}selected{% endif %}>
                        TTS-1-HD (Slower, High Quality)
                    </option>
                </select>
                <p class="text-sm text-gray-500 mt-1">
                    <strong>tts-1:</strong> Optimized for real-time use, lower cost<br>
                    <strong>tts-1-hd:</strong> Higher audio quality, higher cost
                </p>
            </div>
            
            <div class="mb-4">
                <label for="openai_voice" class="block text-sm font-medium text-gray-700 mb-2">Default Voice</label>
                <select name="openai_voice" id="openai_voice" autocomplete="off" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    <option value="alloy" {% if settings.openai_voice == 'alloy' %}selected{% endif %}>Alloy (Neutral)</option>
                    <option value="echo" {% if settings.openai_voice == 'echo' %}selected{% endif %}>Echo (Male)</option>
                    <option value="fable" {% if settings.openai_voice == 'fable' %}selected{% endif %}>Fable (Expressive)</option>
                    <option value="onyx" {% if settings.openai_voice == 'onyx' %}selected{% endif %}>Onyx (Deep Male)</option>
                    <option value="nova" {% if settings.openai_voice == 'nova' %}selected{% endif %}>Nova (Female)</option>
                    <option value="shimmer" {% if settings.openai_voice == 'shimmer' %}selected{% endif %}>Shimmer (Soft Female)</option>
                </select>
                <p class="text-sm text-gray-500 mt-1">Voice used for generating speech audio</p>
            </div>
        </div>
        
        <!-- Cleanup Settings -->
        <div class="pb-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">Audio Cleanup Settings</h2>
            
            <div class="mb-4">
                <label for="audio_retention_days" class="block text-sm font-medium text-gray-700 mb-2">Audio Retention (Days)</label>
                <input type="number" name="audio_retention_days" id="audio_retention_days" required autocomplete="off"
                       value="{{ settings.audio_retention_days }}" min="1" max="365"
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                <p class="text-sm text-gray-500 mt-1">Number of days to keep TTS audio files before automatic cleanup</p>
            </div>
            
            <div class="flex items-center justify-between mb-4">
                <div>
                    <label for="auto_cleanup_enabled" class="block text-sm font-medium text-gray-700">Automatic Cleanup</label>
                    <p class="text-sm text-gray-500 mt-1">Clean up old files during TTS generation (no background job needed)</p>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" name="auto_cleanup_enabled" id="auto_cleanup_enabled" class="sr-only peer" {% if settings.auto_cleanup_enabled %}checked{% endif %}>
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                </label>
            </div>
            
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4">
                <p class="text-sm text-blue-800">
                    <strong>ðŸ’¡ Manual Cleanup:</strong> You can also run cleanup manually from the command line:
                </p>
                <pre class="mt-2 text-xs bg-blue-100 p-2 rounded overflow-x-auto"><code>python manage.py cleanup_tts_audio [--days N] [--dry-run]</code></pre>
            </div>
        </div>
        
        <div class="flex justify-between pt-4 border-t border-gray-200">
            <a href="{% url 'admin:dashboard' %}" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                Cancel
            </a>
            <button type="submit" class="px-6 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
                Save Settings
            </button>
        </div>
    </form>
</div>
{% endblock %}
