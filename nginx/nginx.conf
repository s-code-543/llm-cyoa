events {}

http {
    # Allow very large uploads (up to ~4 GB)
    client_max_body_size 4G;

    # Optional but nice
    sendfile on;

    server {
        listen 443 ssl;
        server_name openwebui.stargate.lan;

        ssl_certificate     /etc/nginx/certs/openwebui.crt;
        ssl_certificate_key /etc/nginx/certs/openwebui.key;

        # Keep connections alive a long time
        keepalive_timeout 3600s;

        location / {
            proxy_pass http://open-webui:8080;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";

            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto https;

            # Aggressive "no timeout" posture for long uploads + long ASR runs
            client_body_timeout 86400s;   # 24 hours to finish sending request body
            proxy_read_timeout  86400s;   # 24 hours waiting for upstream response
            proxy_send_timeout  86400s;   # 24 hours to send data to upstream
            send_timeout        86400s;   # 24 hours while sending response to client
        }
    }
}

